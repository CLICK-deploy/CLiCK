const a="http://localhost:3001";chrome.runtime.onInstalled.addListener(()=>{console.log("CLICK extension installed.")});chrome.runtime.onMessage.addListener((t,c,e)=>{if(t.type==="ANALYZE_PROMPT")return(async()=>{try{const r=await fetch(`${a}/api/analyze-prompt`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userID:t.userID,chatID:t.chatID,prompt:t.prompt})});if(!r.ok)throw new Error(`Server responded with status: ${r.status}`);const o=await r.json();e(o)}catch(r){console.error("분석 API 요청 실패:",r),e({error:r.message})}})(),!0;if(t.type==="FETCH_RECOMMENDED_PROMPTS")return(async()=>{try{const r=await fetch(`${a}/api/recommended-prompts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userID:t.userID,chatID:t.chatID})});if(!r.ok)throw new Error(`Server responded with status: ${r.status}`);const o=await r.json();e(o)}catch(r){console.error("추천 프롬프트 API 요청 실패:",r),e({error:r.message})}})(),!0;if(t.type==="LOGIN")return(async()=>{try{const r=await fetch(`${a}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.userId,password:t.password})});if(!r.ok)throw new Error(`Login failed with status: ${r.status}`);const o=await r.json();await chrome.storage.local.set({userID:o.userID||t.userId,isLoggedIn:!0,loginTime:Date.now()}),e({success:!0,userID:o.userID||t.userId})}catch(r){console.error("로그인 API 요청 실패:",r),e({success:!1,error:r.message})}})(),!0;if(t.type==="LOGOUT")return(async()=>{try{await chrome.storage.local.remove(["userID","isLoggedIn","loginTime"]),e({success:!0})}catch(r){console.error("로그아웃 실패:",r),e({success:!1,error:r.message})}})(),!0;if(t.type==="CHECK_LOGIN")return(async()=>{try{const r=await chrome.storage.local.get(["userID","isLoggedIn"]);e({isLoggedIn:r.isLoggedIn||!1,userID:r.userID||null})}catch(r){console.error("로그인 상태 확인 실패:",r),e({isLoggedIn:!1,userID:null})}})(),!0;if(t.type==="OPEN_LOGIN_PAGE")return chrome.tabs.create({url:chrome.runtime.getURL("login.html")}),e({success:!0}),!0});
